/*! For license information please see main.js.LICENSE.txt */
(()=>{"use strict";var e=document.querySelector(".popup_edit-profile"),t=document.querySelector(".profile__button-edit"),o=e.querySelector(".popup__form"),n=(e.querySelector(".popup__button-close"),e.querySelector(".popup__input-name")),r=e.querySelector(".popup__input-about"),c=e.querySelector(".popup__button-submit-save"),u=document.querySelector(".popup_add_card"),a=document.querySelector(".profile__button-add"),i=u.querySelector(".popup__form"),l=u.querySelector(".popup__button-close"),s=u.querySelector(".popup__input-title"),p=u.querySelector(".popup__input-url"),d=u.querySelector(".popup__button-submit-create"),_=document.querySelector(".popup-photo"),f=(_.querySelector(".popup__button-close"),_.querySelector(".popup-photo__click")),h=_.querySelector(".popup-photo__title"),m=document.querySelector(".profile__name"),v=document.querySelector(".profile__text"),y=document.querySelector(".popup_avatar"),S=document.querySelector(".profile__avatar-img"),b=document.querySelector(".profile__avatar-button"),q=y.querySelector(".popup__form-avatar"),E=(y.querySelector(".popup__button-close"),y.querySelector(".popup__input-avatar-url")),L=y.querySelector(".popup__button-submit-save"),x=document.querySelector(".box"),C=document.querySelectorAll(".popup"),g={id:""},k={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button-submit",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error"};function A(e,t,o){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(o.inputErrorClass),n.textContent=""}var T=function(e,t,o){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(o.inactiveButtonClass),t.removeAttribute("disabled")):(t.classList.add(o.inactiveButtonClass),t.setAttribute("disabled",!0))};function B(e,t){var o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);T(o,n,t),o.forEach((function(o){A(e,o,t)}))}function P(e){document.addEventListener("keydown",O),e.classList.add("popup_opened")}function N(e){document.removeEventListener("keydown",O),e.classList.remove("popup_opened")}var O=function(e){"Escape"===e.key&&N(document.querySelector(".popup_opened"))};function j(e){(e.target.classList.contains("popup")||e.target.classList.contains("popup__button-close"))&&N(e.currentTarget)}var w={url:"https://nomoreparties.co/v1/plus-cohort-8",headers:{authorization:"8b702e0f-d546-40bd-a650-cc80ffee7b56","Content-Type":"application/json"}};function D(e){return e.ok?e.json():Promise.reject(e.status)}function J(e){var t=document.querySelector("#templateCards").content.querySelector(".box__element").cloneNode(!0),o=t.querySelector(".box__image"),n=t.querySelector(".box__heart"),r=e._id,c=t.querySelector(".box__counter"),u=t.querySelector(".box__delete");return o.src=e.link,o.alt=e.name,t.querySelector(".box__title").textContent=e.name,c.textContent=e.likes.length,e.owner._id!==g.id?u.style.display="none":u.addEventListener("click",(function(){(function(e){return fetch("".concat(w.url,"/cards/").concat(e),{method:"DELETE",headers:w.headers}).then(D)})(r).then((function(){t.remove()})).catch((function(e){return console.log(e)}))})),n.addEventListener("click",(function(e){n.classList.contains("box__heart_active")?function(e){return fetch("".concat(w.url,"/cards/likes/").concat(e),{method:"DELETE",headers:w.headers}).then(D)}(r).then((function(e){n.classList.remove("box__heart_active"),c.textContent=e.likes.length})).catch((function(e){return console.log(e)})):function(e){return fetch("".concat(w.url,"/cards/likes/").concat(e),{method:"PUT",headers:w.headers}).then(D)}(r).then((function(e){n.classList.add("box__heart_active"),c.textContent=e.likes.length})).catch((function(e){return console.log(e)}))})),e.likes.forEach((function(e){e._id===g.id&&n.classList.add("box__heart_active")})),o.addEventListener("click",(function(){var t,o;t=e.name,o=e.link,f.src=o,f.alt=t,h.textContent=t,P(_)})),t}function H(e,t){t.textContent=e?"Сохранение...":t===L?"Сохранить":"Создать"}Promise.all([fetch("".concat(w.url,"/users/me"),{headers:w.headers}).then(D),fetch("".concat(w.url,"/cards"),{headers:w.headers}).then(D)]).then((function(e){console.log(e[0]),m.textContent=e[0].name,v.textContent=e[0].about,g.id=e[0]._id,S.src=e[0].avatar,e[1].forEach((function(e){x.append(J(e))}))})).catch((function(e){return console.log(e)})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){t.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);o.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,o){t.validity.valid?A(e,t,o):function(e,t,o,n){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(n.inputErrorClass),r.textContent=o}(e,t,t.validationMessage,o)}(e,r,t),T(o,n,t)}))}))}(t,e)}))}(k),C.forEach((function(e){e.addEventListener("click",j)})),t.addEventListener("click",(function(){B(o,k),n.value=m.textContent,r.value=v.textContent,P(e)})),o.addEventListener("submit",(function(){var t,o;H(!0,c),(t=n.value,o=r.value,fetch("".concat(w.url,"/users/me"),{method:"PATCH",headers:w.headers,body:JSON.stringify({name:t,about:o})}).then(D)).then((function(t){m.textContent=t.name,v.textContent=t.about,N(e)})).catch((function(e){return console.log(e)})).finally((function(){H(!1,c)}))})),a.addEventListener("click",(function(){P(u),i.reset(),P(u),B(u,k)})),l.addEventListener("click",(function(){N(u)})),i.addEventListener("submit",(function(e){var t,o;H(!0,d),(t=s.value,o=p.value,fetch("".concat(w.url,"/cards"),{method:"POST",headers:w.headers,body:JSON.stringify({name:t,link:o})}).then(D)).then((function(t){console.log(t),x.prepend(J(t)),e.target.reset(),N(u),d.setAttribute("disabled",!0)})).catch((function(e){return console.log(e)})).finally((function(){H(!1,d)}))})),b.addEventListener("click",(function(){P(y),q.reset(),P(y),B(y,k)})),q.addEventListener("submit",(function(e){var t;H(!0,L),(t=E.value,fetch("".concat(w.url,"/users/me/avatar"),{method:"PATCH",headers:w.headers,body:JSON.stringify({avatar:t})}).then(D)).then((function(t){S.src=t.avatar,e.target.reset(),N(y)})).catch((function(e){return console.log(e)})).finally((function(){H(!1,L)}))}))})();