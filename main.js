/*! For license information please see main.js.LICENSE.txt */
(()=>{"use strict";var e=document.querySelector(".popup_edit-profile"),t=document.querySelector(".profile__button-edit"),n=e.querySelector(".popup__form"),o=(e.querySelector(".popup__button-close"),e.querySelector(".popup__input-name")),r=e.querySelector(".popup__input-about"),c=e.querySelector(".popup__button-submit-save"),u=document.querySelector(".popup_add_card"),a=document.querySelector(".profile__button-add"),i=u.querySelector(".popup__form"),l=(u.querySelector(".popup__button-close"),u.querySelector(".popup__input-title")),s=u.querySelector(".popup__input-url"),p=u.querySelector(".popup__button-submit-create"),d=document.querySelector(".popup-photo"),f=(d.querySelector(".popup__button-close"),d.querySelector(".popup-photo__click")),_=d.querySelector(".popup-photo__title"),h=document.querySelector(".profile__name"),y=document.querySelector(".profile__text"),m=document.querySelector(".popup_avatar"),v=document.querySelector(".profile__avatar-img"),b=document.querySelector(".profile__avatar-button"),S=m.querySelector(".popup__form-avatar"),q=(m.querySelector(".popup__button-close"),m.querySelector(".popup__input-avatar-url")),E=m.querySelector(".popup__button-submit-save"),L=document.querySelector(".box"),g=document.querySelectorAll(".popup"),x={id:""},C={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button-submit",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error"};function k(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.textContent=""}var A=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n.inactiveButtonClass),t.removeAttribute("disabled")):(t.classList.add(n.inactiveButtonClass),t.setAttribute("disabled",!0))};function T(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);A(n,o,t),n.forEach((function(n){k(e,n,t)}))}function w(e){document.addEventListener("keydown",B),e.classList.add("popup_opened")}function j(e){document.removeEventListener("keydown",B),e.classList.remove("popup_opened")}var B=function(e){"Escape"===e.key&&j(document.querySelector(".popup_opened"))};function O(e){(e.target.classList.contains("popup")||e.target.classList.contains("popup__button-close"))&&j(e.currentTarget)}var P={url:"https://nomoreparties.co/v1/plus-cohort-8",headers:{authorization:"8b702e0f-d546-40bd-a650-cc80ffee7b56","Content-Type":"application/json"}};function N(e){return e.ok?e.json():Promise.reject(e.status)}function D(e){var t=document.querySelector("#templateCards").content.querySelector(".box__element").cloneNode(!0),n=t.querySelector(".box__image"),o=t.querySelector(".box__heart"),r=e._id,c=t.querySelector(".box__counter"),u=t.querySelector(".box__delete");return n.src=e.link,n.alt=e.name,t.querySelector(".box__title").textContent=e.name,c.textContent=e.likes.length,e.owner._id!==x.id?u.style.display="none":u.addEventListener("click",(function(){(function(e){return fetch("".concat(P.url,"/cards/").concat(e),{method:"DELETE",headers:P.headers}).then(N)})(r).then((function(){t.remove()})).catch((function(e){return console.log(e)}))})),o.addEventListener("click",(function(e){o.classList.contains("box__heart_active")?function(e){return fetch("".concat(P.url,"/cards/likes/").concat(e),{method:"DELETE",headers:P.headers}).then(N)}(r).then((function(e){o.classList.remove("box__heart_active"),c.textContent=e.likes.length})).catch((function(e){return console.log(e)})):function(e){return fetch("".concat(P.url,"/cards/likes/").concat(e),{method:"PUT",headers:P.headers}).then(N)}(r).then((function(e){o.classList.add("box__heart_active"),c.textContent=e.likes.length})).catch((function(e){return console.log(e)}))})),e.likes.forEach((function(e){e._id===x.id&&o.classList.add("box__heart_active")})),n.addEventListener("click",(function(){var t,n;t=e.name,n=e.link,f.src=n,f.alt=t,_.textContent=t,w(d)})),t}function I(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function J(e,t){t.textContent=e?"Сохранение...":t===E?"Сохранить":"Создать"}Promise.all([fetch("".concat(P.url,"/users/me"),{headers:P.headers}).then(N),fetch("".concat(P.url,"/cards"),{headers:P.headers}).then(N)]).then((function(e){var t,n,o=(n=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var o,r,c=[],u=!0,a=!1;try{for(n=n.call(e);!(u=(o=n.next()).done)&&(c.push(o.value),!t||c.length!==t);u=!0);}catch(e){a=!0,r=e}finally{try{u||null==n.return||n.return()}finally{if(a)throw r}}return c}}(t,n)||function(e,t){if(e){if("string"==typeof e)return I(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?I(e,t):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),r=o[0],c=o[1];h.textContent=r.name,y.textContent=r.about,x.id=r._id,v.src=r.avatar,c.forEach((function(e){L.append(D(e))}))})).catch((function(e){return console.error(e)})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){t.addEventListener("submit",(function(e){e.preventDefault()})),function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){t.validity.valid?k(e,t,n):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o.inputErrorClass),r.textContent=n}(e,t,t.validationMessage,n)}(e,r,t),A(n,o,t)}))}))}(t,e)}))}(C),g.forEach((function(e){e.addEventListener("click",O)})),t.addEventListener("click",(function(){T(n,C),o.value=h.textContent,r.value=y.textContent,w(e)})),n.addEventListener("submit",(function(){var t,n;J(!0,c),(t=o.value,n=r.value,fetch("".concat(P.url,"/users/me"),{method:"PATCH",headers:P.headers,body:JSON.stringify({name:t,about:n})}).then(N)).then((function(t){h.textContent=t.name,y.textContent=t.about,j(e)})).catch((function(e){return console.log(e)})).finally((function(){J(!1,c)}))})),a.addEventListener("click",(function(){i.reset(),w(u),T(u,C)})),i.addEventListener("submit",(function(e){var t,n;J(!0,p),(t=l.value,n=s.value,fetch("".concat(P.url,"/cards"),{method:"POST",headers:P.headers,body:JSON.stringify({name:t,link:n})}).then(N)).then((function(t){console.log(t),L.prepend(D(t)),e.target.reset(),j(u),p.setAttribute("disabled",!0)})).catch((function(e){return console.log(e)})).finally((function(){J(!1,p)}))})),b.addEventListener("click",(function(){S.reset(),w(m),T(m,C)})),S.addEventListener("submit",(function(e){var t;J(!0,E),(t=q.value,fetch("".concat(P.url,"/users/me/avatar"),{method:"PATCH",headers:P.headers,body:JSON.stringify({avatar:t})}).then(N)).then((function(t){v.src=t.avatar,e.target.reset(),j(m)})).catch((function(e){return console.log(e)})).finally((function(){J(!1,E)}))}))})();